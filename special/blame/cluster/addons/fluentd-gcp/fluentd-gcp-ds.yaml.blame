0000000000000000000000000000000000000000;;	apiVersion: extensions/v1beta1
0000000000000000000000000000000000000000;;	kind: DaemonSet
0000000000000000000000000000000000000000;;	metadata:
0000000000000000000000000000000000000000;;	  name: fluentd-gcp-v2.0
0000000000000000000000000000000000000000;;	  namespace: kube-system
0000000000000000000000000000000000000000;;	  labels:
0000000000000000000000000000000000000000;;	    k8s-app: fluentd-gcp
0000000000000000000000000000000000000000;;	    kubernetes.io/cluster-service: "true"
0000000000000000000000000000000000000000;;	    addonmanager.kubernetes.io/mode: Reconcile
0000000000000000000000000000000000000000;;	    version: v2.0
0000000000000000000000000000000000000000;;	spec:
0000000000000000000000000000000000000000;;	  updateStrategy:
0000000000000000000000000000000000000000;;	    type: RollingUpdate
0000000000000000000000000000000000000000;;	  template:
0000000000000000000000000000000000000000;;	    metadata:
0000000000000000000000000000000000000000;;	      labels:
0000000000000000000000000000000000000000;;	        k8s-app: fluentd-gcp
0000000000000000000000000000000000000000;;	        kubernetes.io/cluster-service: "true"
0000000000000000000000000000000000000000;;	        version: v2.0
0000000000000000000000000000000000000000;;	      # This annotation ensures that fluentd does not get evicted if the node
0000000000000000000000000000000000000000;;	      # supports critical pod annotation based priority scheme.
0000000000000000000000000000000000000000;;	      # Note that this does not guarantee admission on the nodes (#40573).
0000000000000000000000000000000000000000;;	      annotations:
0000000000000000000000000000000000000000;;	        scheduler.alpha.kubernetes.io/critical-pod: ''
0000000000000000000000000000000000000000;;	    spec:
0000000000000000000000000000000000000000;;	      dnsPolicy: Default
0000000000000000000000000000000000000000;;	      hostNetwork: true
0000000000000000000000000000000000000000;;	      containers:
0000000000000000000000000000000000000000;;	      - name: fluentd-gcp
0000000000000000000000000000000000000000;;	        image: gcr.io/google-containers/fluentd-gcp:2.0.8
0000000000000000000000000000000000000000;;	        # If fluentd consumes its own logs, the following situation may happen:
0000000000000000000000000000000000000000;;	        # fluentd fails to send a chunk to the server => writes it to the log =>
0000000000000000000000000000000000000000;;	        # tries to send this message to the server => fails to send a chunk and so on.
0000000000000000000000000000000000000000;;	        # Writing to a file, which is not exported to the back-end prevents it.
0000000000000000000000000000000000000000;;	        # It also allows to increase the fluentd verbosity by default.
0000000000000000000000000000000000000000;;	        command:
0000000000000000000000000000000000000000;;	          - '/bin/sh'
0000000000000000000000000000000000000000;;	          - '-c'
0000000000000000000000000000000000000000;;	          - '/run.sh $FLUENTD_ARGS'
0000000000000000000000000000000000000000;;	        env:
0000000000000000000000000000000000000000;;	        - name: FLUENTD_ARGS
0000000000000000000000000000000000000000;;	          value: --no-supervisor -q
0000000000000000000000000000000000000000;;	        resources:
0000000000000000000000000000000000000000;;	          limits:
0000000000000000000000000000000000000000;;	            memory: 300Mi
0000000000000000000000000000000000000000;;	          requests:
0000000000000000000000000000000000000000;;	            cpu: 100m
0000000000000000000000000000000000000000;;	            memory: 200Mi
0000000000000000000000000000000000000000;;	        volumeMounts:
0000000000000000000000000000000000000000;;	        - name: varlog
0000000000000000000000000000000000000000;;	          mountPath: /var/log
0000000000000000000000000000000000000000;;	        - name: varlibdockercontainers
0000000000000000000000000000000000000000;;	          mountPath: /var/lib/docker/containers
0000000000000000000000000000000000000000;;	          readOnly: true
0000000000000000000000000000000000000000;;	        - name: libsystemddir
0000000000000000000000000000000000000000;;	          mountPath: /host/lib
0000000000000000000000000000000000000000;;	          readOnly: true
0000000000000000000000000000000000000000;;	        - name: config-volume
0000000000000000000000000000000000000000;;	          mountPath: /etc/fluent/config.d
0000000000000000000000000000000000000000;;	        # Liveness probe is aimed to help in situarions where fluentd
0000000000000000000000000000000000000000;;	        # silently hangs for no apparent reasons until manual restart.
0000000000000000000000000000000000000000;;	        # The idea of this probe is that if fluentd is not queueing or
0000000000000000000000000000000000000000;;	        # flushing chunks for 5 minutes, something is not right. If
0000000000000000000000000000000000000000;;	        # you want to change the fluentd configuration, reducing amount of
0000000000000000000000000000000000000000;;	        # logs fluentd collects, consider changing the threshold or turning
0000000000000000000000000000000000000000;;	        # liveness probe off completely.
0000000000000000000000000000000000000000;;	        livenessProbe:
0000000000000000000000000000000000000000;;	          initialDelaySeconds: 600
0000000000000000000000000000000000000000;;	          periodSeconds: 60
0000000000000000000000000000000000000000;;	          exec:
0000000000000000000000000000000000000000;;	            command:
0000000000000000000000000000000000000000;;	            - '/bin/sh'
0000000000000000000000000000000000000000;;	            - '-c'
0000000000000000000000000000000000000000;;	            - >
0000000000000000000000000000000000000000;;	              LIVENESS_THRESHOLD_SECONDS=${LIVENESS_THRESHOLD_SECONDS:-300};
0000000000000000000000000000000000000000;;	              STUCK_THRESHOLD_SECONDS=${LIVENESS_THRESHOLD_SECONDS:-900};
0000000000000000000000000000000000000000;;	              if [ ! -e /var/log/fluentd-buffers ];
0000000000000000000000000000000000000000;;	              then
0000000000000000000000000000000000000000;;	                exit 1;
0000000000000000000000000000000000000000;;	              fi;
0000000000000000000000000000000000000000;;	              LAST_MODIFIED_DATE=`stat /var/log/fluentd-buffers | grep Modify | sed -r "s/Modify: (.*)/\1/"`;
0000000000000000000000000000000000000000;;	              LAST_MODIFIED_TIMESTAMP=`date -d "$LAST_MODIFIED_DATE" +%s`;
0000000000000000000000000000000000000000;;	              if [ `date +%s` -gt `expr $LAST_MODIFIED_TIMESTAMP + $STUCK_THRESHOLD_SECONDS` ];
0000000000000000000000000000000000000000;;	              then
0000000000000000000000000000000000000000;;	                rm -rf /var/log/fluentd-buffers;
0000000000000000000000000000000000000000;;	                exit 1;
0000000000000000000000000000000000000000;;	              fi;
0000000000000000000000000000000000000000;;	              if [ `date +%s` -gt `expr $LAST_MODIFIED_TIMESTAMP + $LIVENESS_THRESHOLD_SECONDS` ];
0000000000000000000000000000000000000000;;	              then
0000000000000000000000000000000000000000;;	                exit 1;
0000000000000000000000000000000000000000;;	              fi;
0000000000000000000000000000000000000000;;	      - name: prometheus-to-sd-exporter
0000000000000000000000000000000000000000;;	        image: gcr.io/google-containers/prometheus-to-sd:v0.1.3
0000000000000000000000000000000000000000;;	        command:
0000000000000000000000000000000000000000;;	          - /monitor
0000000000000000000000000000000000000000;;	          - --component=fluentd
0000000000000000000000000000000000000000;;	          - --target-port=31337
0000000000000000000000000000000000000000;;	          - --stackdriver-prefix=container.googleapis.com/internal/addons
0000000000000000000000000000000000000000;;	          - --whitelisted-metrics=stackdriver_successful_requests_count,stackdriver_failed_requests_count,stackdriver_ingested_entries_count,stackdriver_dropped_entries_count
0000000000000000000000000000000000000000;;	        volumeMounts:
0000000000000000000000000000000000000000;;	        - name: ssl-certs
0000000000000000000000000000000000000000;;	          mountPath: /etc/ssl/certs
0000000000000000000000000000000000000000;;	      nodeSelector:
0000000000000000000000000000000000000000;;	        beta.kubernetes.io/fluentd-ds-ready: "true"
0000000000000000000000000000000000000000;;	      tolerations:
0000000000000000000000000000000000000000;;	      - key: "node.alpha.kubernetes.io/ismaster"
0000000000000000000000000000000000000000;;	        effect: "NoSchedule"
0000000000000000000000000000000000000000;;	      - operator: "Exists"
0000000000000000000000000000000000000000;;	        effect: "NoExecute"
0000000000000000000000000000000000000000;;	      #TODO: remove this toleration once #44445 is properly fixed.
0000000000000000000000000000000000000000;;	      - operator: "Exists"
0000000000000000000000000000000000000000;;	        effect: "NoSchedule"
0000000000000000000000000000000000000000;;	      terminationGracePeriodSeconds: 30
0000000000000000000000000000000000000000;;	      volumes:
0000000000000000000000000000000000000000;;	      - name: varlog
0000000000000000000000000000000000000000;;	        hostPath:
0000000000000000000000000000000000000000;;	          path: /var/log
0000000000000000000000000000000000000000;;	      - name: varlibdockercontainers
0000000000000000000000000000000000000000;;	        hostPath:
0000000000000000000000000000000000000000;;	          path: /var/lib/docker/containers
0000000000000000000000000000000000000000;;	      - name: libsystemddir
0000000000000000000000000000000000000000;;	        hostPath:
0000000000000000000000000000000000000000;;	          path: /usr/lib64
0000000000000000000000000000000000000000;;	      - name: config-volume
0000000000000000000000000000000000000000;;	        configMap:
0000000000000000000000000000000000000000;;	          name: fluentd-gcp-config-v1.1
0000000000000000000000000000000000000000;;	      - name: ssl-certs
0000000000000000000000000000000000000000;;	        hostPath:
0000000000000000000000000000000000000000;;	          path: /etc/ssl/certs
