0000000000000000000000000000000000000000;;	# Rollback workflow
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	Build it in this directory.
0000000000000000000000000000000000000000;;	Make sure you have etcd dependency ready. Last time we use etcd v3.0.7.
0000000000000000000000000000000000000000;;	```
0000000000000000000000000000000000000000;;	$ go build .
0000000000000000000000000000000000000000;;	```
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	Run it:
0000000000000000000000000000000000000000;;	```
0000000000000000000000000000000000000000;;	$ ./rollback2 --data-dir $ETCD_DATA_DIR --ttl 1h
0000000000000000000000000000000000000000;;	```
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	This will rollback KV pairs from v3 into v2.
0000000000000000000000000000000000000000;;	If a key was attached to a lease before, it will be created with given TTL (default to 1h).
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	On success, it will print at the end:
0000000000000000000000000000000000000000;;	```
0000000000000000000000000000000000000000;;	Finished successfully
0000000000000000000000000000000000000000;;	```
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	Repeat this on all etcd members.
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	You can do simple check on keys (if any exists):
0000000000000000000000000000000000000000;;	```
0000000000000000000000000000000000000000;;	etcdctl ls /
0000000000000000000000000000000000000000;;	```
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	Important Note
0000000000000000000000000000000000000000;;	------
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	This tool isn't recommended to use if any problem comes up in etcd3 backend.
0000000000000000000000000000000000000000;;	Please report bugs and we will fix it soon.
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	If it's still preferred to run this tool, please backup all your data beforehand.
0000000000000000000000000000000000000000;;	This tool will also back up datadir to same path with ".rollback.backup" suffix.
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	Caveats:
0000000000000000000000000000000000000000;;	- The tool doesn't preserve versions of keys.
0000000000000000000000000000000000000000;;	- If any v2 data exists before rollback, they will be wiped out.
0000000000000000000000000000000000000000;;	- v3 data only exists in the backup after successful rollback.
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	[![Analytics](https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/cluster/images/etcd/rollback/README.md?pixel)]()
