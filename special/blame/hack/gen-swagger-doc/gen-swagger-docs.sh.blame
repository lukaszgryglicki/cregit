0000000000000000000000000000000000000000;;	#!/bin/bash
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# Copyright 2014 The Kubernetes Authors.
0000000000000000000000000000000000000000;;	#
0000000000000000000000000000000000000000;;	# Licensed under the Apache License, Version 2.0 (the "License");
0000000000000000000000000000000000000000;;	# you may not use this file except in compliance with the License.
0000000000000000000000000000000000000000;;	# You may obtain a copy of the License at
0000000000000000000000000000000000000000;;	#
0000000000000000000000000000000000000000;;	#     http://www.apache.org/licenses/LICENSE-2.0
0000000000000000000000000000000000000000;;	#
0000000000000000000000000000000000000000;;	# Unless required by applicable law or agreed to in writing, software
0000000000000000000000000000000000000000;;	# distributed under the License is distributed on an "AS IS" BASIS,
0000000000000000000000000000000000000000;;	# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
0000000000000000000000000000000000000000;;	# See the License for the specific language governing permissions and
0000000000000000000000000000000000000000;;	# limitations under the License.
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# Script to generate docs from the latest swagger spec.
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	set -o errexit
0000000000000000000000000000000000000000;;	set -o nounset
0000000000000000000000000000000000000000;;	set -o pipefail
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	cd /build
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# gendocs takes "input.json" as the input swagger spec.
0000000000000000000000000000000000000000;;	# $1 is expected to be <group>_<version>
0000000000000000000000000000000000000000;;	cp /swagger-source/"$1".json input.json
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	./gradle-2.5/bin/gradle gendocs --info
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	#insert a TOC for top level API objects
0000000000000000000000000000000000000000;;	buf="== Top Level API Objects\n\n"
0000000000000000000000000000000000000000;;	top_level_models=$(grep '&[A-Za-z]*{},' /register.go | sed 's/.*&//;s/{},//')
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# check if the top level models exist in the definitions.adoc. If they exist,
0000000000000000000000000000000000000000;;	# their name will be <version>.<model_name>
0000000000000000000000000000000000000000;;	VERSION="${1#*_}"
0000000000000000000000000000000000000000;;	for m in $top_level_models
0000000000000000000000000000000000000000;;	do
0000000000000000000000000000000000000000;;	  if grep -xq "=== ${VERSION}.$m" ./definitions.adoc
0000000000000000000000000000000000000000;;	  then
0000000000000000000000000000000000000000;;	    buf+="* <<${VERSION}.$m>>\n"
0000000000000000000000000000000000000000;;	  fi
0000000000000000000000000000000000000000;;	done
0000000000000000000000000000000000000000;;	sed -i "1i $buf" ./definitions.adoc
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# fix the links in .adoc, replace <<x.y>> with link:definitions.html#_x_y[x.y], and lowercase the _x_y part
0000000000000000000000000000000000000000;;	sed -i -e 's|<<\(.*\)\.\(.*\)>>|link:#_\L\1_\2\E[\1.\2]|g' ./definitions.adoc
0000000000000000000000000000000000000000;;	sed -i -e 's|<<\(.*\)\.\(.*\)>>|link:../definitions#_\L\1_\2\E[\1.\2]|g' ./paths.adoc
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# fix the link to <<any>>
0000000000000000000000000000000000000000;;	sed -i -e 's|<<any>>|link:#_any[any]|g' ./definitions.adoc
0000000000000000000000000000000000000000;;	sed -i -e 's|<<any>>|link:../definitions#_any[any]|g' ./paths.adoc
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# change the title of paths.adoc from "paths" to "operations"
0000000000000000000000000000000000000000;;	sed -i 's|== Paths|== Operations|g' ./paths.adoc
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# $$ has special meaning in asciidoc, we need to escape it
0000000000000000000000000000000000000000;;	sed -i 's|\$\$|+++$$+++|g' ./definitions.adoc
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	echo -e "=== any\nRepresents an untyped JSON map - see the description of the field for more info about the structure of this object." >> ./definitions.adoc
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	asciidoctor definitions.adoc
0000000000000000000000000000000000000000;;	asciidoctor paths.adoc
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	cp definitions.html /output/
0000000000000000000000000000000000000000;;	cp paths.html /output/operations.html
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	echo "SUCCESS"
