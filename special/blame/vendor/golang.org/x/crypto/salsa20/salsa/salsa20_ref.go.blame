0000000000000000000000000000000000000000;;	// Copyright 2012 The Go Authors. All rights reserved.
0000000000000000000000000000000000000000;;	// Use of this source code is governed by a BSD-style
0000000000000000000000000000000000000000;;	// license that can be found in the LICENSE file.
ea5ce496739655bc10dc42138f80f7e34ba4dc2e;;	
0000000000000000000000000000000000000000;;	// +build !amd64 appengine gccgo
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	package salsa
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	const rounds = 20
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	// core applies the Salsa20 core function to 16-byte input in, 32-byte key k,
0000000000000000000000000000000000000000;;	// and 16-byte constant c, and puts the result into 64-byte array out.
0000000000000000000000000000000000000000;;	func core(out *[64]byte, in *[16]byte, k *[32]byte, c *[16]byte) {
0000000000000000000000000000000000000000;;		j0 := uint32(c[0]) | uint32(c[1])<<8 | uint32(c[2])<<16 | uint32(c[3])<<24
0000000000000000000000000000000000000000;;		j1 := uint32(k[0]) | uint32(k[1])<<8 | uint32(k[2])<<16 | uint32(k[3])<<24
0000000000000000000000000000000000000000;;		j2 := uint32(k[4]) | uint32(k[5])<<8 | uint32(k[6])<<16 | uint32(k[7])<<24
0000000000000000000000000000000000000000;;		j3 := uint32(k[8]) | uint32(k[9])<<8 | uint32(k[10])<<16 | uint32(k[11])<<24
0000000000000000000000000000000000000000;;		j4 := uint32(k[12]) | uint32(k[13])<<8 | uint32(k[14])<<16 | uint32(k[15])<<24
0000000000000000000000000000000000000000;;		j5 := uint32(c[4]) | uint32(c[5])<<8 | uint32(c[6])<<16 | uint32(c[7])<<24
0000000000000000000000000000000000000000;;		j6 := uint32(in[0]) | uint32(in[1])<<8 | uint32(in[2])<<16 | uint32(in[3])<<24
0000000000000000000000000000000000000000;;		j7 := uint32(in[4]) | uint32(in[5])<<8 | uint32(in[6])<<16 | uint32(in[7])<<24
0000000000000000000000000000000000000000;;		j8 := uint32(in[8]) | uint32(in[9])<<8 | uint32(in[10])<<16 | uint32(in[11])<<24
0000000000000000000000000000000000000000;;		j9 := uint32(in[12]) | uint32(in[13])<<8 | uint32(in[14])<<16 | uint32(in[15])<<24
0000000000000000000000000000000000000000;;		j10 := uint32(c[8]) | uint32(c[9])<<8 | uint32(c[10])<<16 | uint32(c[11])<<24
0000000000000000000000000000000000000000;;		j11 := uint32(k[16]) | uint32(k[17])<<8 | uint32(k[18])<<16 | uint32(k[19])<<24
0000000000000000000000000000000000000000;;		j12 := uint32(k[20]) | uint32(k[21])<<8 | uint32(k[22])<<16 | uint32(k[23])<<24
0000000000000000000000000000000000000000;;		j13 := uint32(k[24]) | uint32(k[25])<<8 | uint32(k[26])<<16 | uint32(k[27])<<24
0000000000000000000000000000000000000000;;		j14 := uint32(k[28]) | uint32(k[29])<<8 | uint32(k[30])<<16 | uint32(k[31])<<24
0000000000000000000000000000000000000000;;		j15 := uint32(c[12]) | uint32(c[13])<<8 | uint32(c[14])<<16 | uint32(c[15])<<24
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		x0, x1, x2, x3, x4, x5, x6, x7, x8 := j0, j1, j2, j3, j4, j5, j6, j7, j8
0000000000000000000000000000000000000000;;		x9, x10, x11, x12, x13, x14, x15 := j9, j10, j11, j12, j13, j14, j15
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		for i := 0; i < rounds; i += 2 {
0000000000000000000000000000000000000000;;			u := x0 + x12
0000000000000000000000000000000000000000;;			x4 ^= u<<7 | u>>(32-7)
0000000000000000000000000000000000000000;;			u = x4 + x0
0000000000000000000000000000000000000000;;			x8 ^= u<<9 | u>>(32-9)
0000000000000000000000000000000000000000;;			u = x8 + x4
0000000000000000000000000000000000000000;;			x12 ^= u<<13 | u>>(32-13)
0000000000000000000000000000000000000000;;			u = x12 + x8
0000000000000000000000000000000000000000;;			x0 ^= u<<18 | u>>(32-18)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			u = x5 + x1
0000000000000000000000000000000000000000;;			x9 ^= u<<7 | u>>(32-7)
0000000000000000000000000000000000000000;;			u = x9 + x5
0000000000000000000000000000000000000000;;			x13 ^= u<<9 | u>>(32-9)
0000000000000000000000000000000000000000;;			u = x13 + x9
0000000000000000000000000000000000000000;;			x1 ^= u<<13 | u>>(32-13)
0000000000000000000000000000000000000000;;			u = x1 + x13
0000000000000000000000000000000000000000;;			x5 ^= u<<18 | u>>(32-18)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			u = x10 + x6
0000000000000000000000000000000000000000;;			x14 ^= u<<7 | u>>(32-7)
0000000000000000000000000000000000000000;;			u = x14 + x10
0000000000000000000000000000000000000000;;			x2 ^= u<<9 | u>>(32-9)
0000000000000000000000000000000000000000;;			u = x2 + x14
0000000000000000000000000000000000000000;;			x6 ^= u<<13 | u>>(32-13)
0000000000000000000000000000000000000000;;			u = x6 + x2
0000000000000000000000000000000000000000;;			x10 ^= u<<18 | u>>(32-18)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			u = x15 + x11
0000000000000000000000000000000000000000;;			x3 ^= u<<7 | u>>(32-7)
0000000000000000000000000000000000000000;;			u = x3 + x15
0000000000000000000000000000000000000000;;			x7 ^= u<<9 | u>>(32-9)
0000000000000000000000000000000000000000;;			u = x7 + x3
0000000000000000000000000000000000000000;;			x11 ^= u<<13 | u>>(32-13)
0000000000000000000000000000000000000000;;			u = x11 + x7
0000000000000000000000000000000000000000;;			x15 ^= u<<18 | u>>(32-18)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			u = x0 + x3
0000000000000000000000000000000000000000;;			x1 ^= u<<7 | u>>(32-7)
0000000000000000000000000000000000000000;;			u = x1 + x0
0000000000000000000000000000000000000000;;			x2 ^= u<<9 | u>>(32-9)
0000000000000000000000000000000000000000;;			u = x2 + x1
0000000000000000000000000000000000000000;;			x3 ^= u<<13 | u>>(32-13)
0000000000000000000000000000000000000000;;			u = x3 + x2
0000000000000000000000000000000000000000;;			x0 ^= u<<18 | u>>(32-18)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			u = x5 + x4
0000000000000000000000000000000000000000;;			x6 ^= u<<7 | u>>(32-7)
0000000000000000000000000000000000000000;;			u = x6 + x5
0000000000000000000000000000000000000000;;			x7 ^= u<<9 | u>>(32-9)
0000000000000000000000000000000000000000;;			u = x7 + x6
0000000000000000000000000000000000000000;;			x4 ^= u<<13 | u>>(32-13)
0000000000000000000000000000000000000000;;			u = x4 + x7
0000000000000000000000000000000000000000;;			x5 ^= u<<18 | u>>(32-18)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			u = x10 + x9
0000000000000000000000000000000000000000;;			x11 ^= u<<7 | u>>(32-7)
0000000000000000000000000000000000000000;;			u = x11 + x10
0000000000000000000000000000000000000000;;			x8 ^= u<<9 | u>>(32-9)
0000000000000000000000000000000000000000;;			u = x8 + x11
0000000000000000000000000000000000000000;;			x9 ^= u<<13 | u>>(32-13)
0000000000000000000000000000000000000000;;			u = x9 + x8
0000000000000000000000000000000000000000;;			x10 ^= u<<18 | u>>(32-18)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			u = x15 + x14
0000000000000000000000000000000000000000;;			x12 ^= u<<7 | u>>(32-7)
0000000000000000000000000000000000000000;;			u = x12 + x15
0000000000000000000000000000000000000000;;			x13 ^= u<<9 | u>>(32-9)
0000000000000000000000000000000000000000;;			u = x13 + x12
0000000000000000000000000000000000000000;;			x14 ^= u<<13 | u>>(32-13)
0000000000000000000000000000000000000000;;			u = x14 + x13
0000000000000000000000000000000000000000;;			x15 ^= u<<18 | u>>(32-18)
0000000000000000000000000000000000000000;;		}
0000000000000000000000000000000000000000;;		x0 += j0
0000000000000000000000000000000000000000;;		x1 += j1
0000000000000000000000000000000000000000;;		x2 += j2
0000000000000000000000000000000000000000;;		x3 += j3
0000000000000000000000000000000000000000;;		x4 += j4
0000000000000000000000000000000000000000;;		x5 += j5
0000000000000000000000000000000000000000;;		x6 += j6
0000000000000000000000000000000000000000;;		x7 += j7
0000000000000000000000000000000000000000;;		x8 += j8
0000000000000000000000000000000000000000;;		x9 += j9
0000000000000000000000000000000000000000;;		x10 += j10
0000000000000000000000000000000000000000;;		x11 += j11
0000000000000000000000000000000000000000;;		x12 += j12
0000000000000000000000000000000000000000;;		x13 += j13
0000000000000000000000000000000000000000;;		x14 += j14
0000000000000000000000000000000000000000;;		x15 += j15
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[0] = byte(x0)
0000000000000000000000000000000000000000;;		out[1] = byte(x0 >> 8)
0000000000000000000000000000000000000000;;		out[2] = byte(x0 >> 16)
0000000000000000000000000000000000000000;;		out[3] = byte(x0 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[4] = byte(x1)
0000000000000000000000000000000000000000;;		out[5] = byte(x1 >> 8)
0000000000000000000000000000000000000000;;		out[6] = byte(x1 >> 16)
0000000000000000000000000000000000000000;;		out[7] = byte(x1 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[8] = byte(x2)
0000000000000000000000000000000000000000;;		out[9] = byte(x2 >> 8)
0000000000000000000000000000000000000000;;		out[10] = byte(x2 >> 16)
0000000000000000000000000000000000000000;;		out[11] = byte(x2 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[12] = byte(x3)
0000000000000000000000000000000000000000;;		out[13] = byte(x3 >> 8)
0000000000000000000000000000000000000000;;		out[14] = byte(x3 >> 16)
0000000000000000000000000000000000000000;;		out[15] = byte(x3 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[16] = byte(x4)
0000000000000000000000000000000000000000;;		out[17] = byte(x4 >> 8)
0000000000000000000000000000000000000000;;		out[18] = byte(x4 >> 16)
0000000000000000000000000000000000000000;;		out[19] = byte(x4 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[20] = byte(x5)
0000000000000000000000000000000000000000;;		out[21] = byte(x5 >> 8)
0000000000000000000000000000000000000000;;		out[22] = byte(x5 >> 16)
0000000000000000000000000000000000000000;;		out[23] = byte(x5 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[24] = byte(x6)
0000000000000000000000000000000000000000;;		out[25] = byte(x6 >> 8)
0000000000000000000000000000000000000000;;		out[26] = byte(x6 >> 16)
0000000000000000000000000000000000000000;;		out[27] = byte(x6 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[28] = byte(x7)
0000000000000000000000000000000000000000;;		out[29] = byte(x7 >> 8)
0000000000000000000000000000000000000000;;		out[30] = byte(x7 >> 16)
0000000000000000000000000000000000000000;;		out[31] = byte(x7 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[32] = byte(x8)
0000000000000000000000000000000000000000;;		out[33] = byte(x8 >> 8)
0000000000000000000000000000000000000000;;		out[34] = byte(x8 >> 16)
0000000000000000000000000000000000000000;;		out[35] = byte(x8 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[36] = byte(x9)
0000000000000000000000000000000000000000;;		out[37] = byte(x9 >> 8)
0000000000000000000000000000000000000000;;		out[38] = byte(x9 >> 16)
0000000000000000000000000000000000000000;;		out[39] = byte(x9 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[40] = byte(x10)
0000000000000000000000000000000000000000;;		out[41] = byte(x10 >> 8)
0000000000000000000000000000000000000000;;		out[42] = byte(x10 >> 16)
0000000000000000000000000000000000000000;;		out[43] = byte(x10 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[44] = byte(x11)
0000000000000000000000000000000000000000;;		out[45] = byte(x11 >> 8)
0000000000000000000000000000000000000000;;		out[46] = byte(x11 >> 16)
0000000000000000000000000000000000000000;;		out[47] = byte(x11 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[48] = byte(x12)
0000000000000000000000000000000000000000;;		out[49] = byte(x12 >> 8)
0000000000000000000000000000000000000000;;		out[50] = byte(x12 >> 16)
0000000000000000000000000000000000000000;;		out[51] = byte(x12 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[52] = byte(x13)
0000000000000000000000000000000000000000;;		out[53] = byte(x13 >> 8)
0000000000000000000000000000000000000000;;		out[54] = byte(x13 >> 16)
0000000000000000000000000000000000000000;;		out[55] = byte(x13 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[56] = byte(x14)
0000000000000000000000000000000000000000;;		out[57] = byte(x14 >> 8)
0000000000000000000000000000000000000000;;		out[58] = byte(x14 >> 16)
0000000000000000000000000000000000000000;;		out[59] = byte(x14 >> 24)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		out[60] = byte(x15)
0000000000000000000000000000000000000000;;		out[61] = byte(x15 >> 8)
0000000000000000000000000000000000000000;;		out[62] = byte(x15 >> 16)
0000000000000000000000000000000000000000;;		out[63] = byte(x15 >> 24)
0000000000000000000000000000000000000000;;	}
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	// XORKeyStream crypts bytes from in to out using the given key and counters.
0000000000000000000000000000000000000000;;	// In and out may be the same slice but otherwise should not overlap. Counter
0000000000000000000000000000000000000000;;	// contains the raw salsa20 counter bytes (both nonce and block counter).
0000000000000000000000000000000000000000;;	func XORKeyStream(out, in []byte, counter *[16]byte, key *[32]byte) {
0000000000000000000000000000000000000000;;		var block [64]byte
0000000000000000000000000000000000000000;;		var counterCopy [16]byte
0000000000000000000000000000000000000000;;		copy(counterCopy[:], counter[:])
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		for len(in) >= 64 {
0000000000000000000000000000000000000000;;			core(&block, &counterCopy, key, &Sigma)
0000000000000000000000000000000000000000;;			for i, x := range block {
0000000000000000000000000000000000000000;;				out[i] = in[i] ^ x
0000000000000000000000000000000000000000;;			}
0000000000000000000000000000000000000000;;			u := uint32(1)
0000000000000000000000000000000000000000;;			for i := 8; i < 16; i++ {
0000000000000000000000000000000000000000;;				u += uint32(counterCopy[i])
0000000000000000000000000000000000000000;;				counterCopy[i] = byte(u)
0000000000000000000000000000000000000000;;				u >>= 8
0000000000000000000000000000000000000000;;			}
0000000000000000000000000000000000000000;;			in = in[64:]
0000000000000000000000000000000000000000;;			out = out[64:]
0000000000000000000000000000000000000000;;		}
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		if len(in) > 0 {
0000000000000000000000000000000000000000;;			core(&block, &counterCopy, key, &Sigma)
0000000000000000000000000000000000000000;;			for i, v := range in {
0000000000000000000000000000000000000000;;				out[i] = v ^ block[i]
0000000000000000000000000000000000000000;;			}
0000000000000000000000000000000000000000;;		}
0000000000000000000000000000000000000000;;	}
