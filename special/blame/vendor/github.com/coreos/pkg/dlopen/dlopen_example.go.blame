0000000000000000000000000000000000000000;;	// Copyright 2015 CoreOS, Inc.
0000000000000000000000000000000000000000;;	//
0000000000000000000000000000000000000000;;	// Licensed under the Apache License, Version 2.0 (the "License");
0000000000000000000000000000000000000000;;	// you may not use this file except in compliance with the License.
0000000000000000000000000000000000000000;;	// You may obtain a copy of the License at
0000000000000000000000000000000000000000;;	//
0000000000000000000000000000000000000000;;	//     http://www.apache.org/licenses/LICENSE-2.0
0000000000000000000000000000000000000000;;	//
0000000000000000000000000000000000000000;;	// Unless required by applicable law or agreed to in writing, software
0000000000000000000000000000000000000000;;	// distributed under the License is distributed on an "AS IS" BASIS,
0000000000000000000000000000000000000000;;	// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
0000000000000000000000000000000000000000;;	// See the License for the specific language governing permissions and
0000000000000000000000000000000000000000;;	// limitations under the License.
0000000000000000000000000000000000000000;;	//
0000000000000000000000000000000000000000;;	// +build linux
2e6b23087c07e0ca25a1986b378417fd0915b4d7;;	
0000000000000000000000000000000000000000;;	package dlopen
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	// #include <string.h>
0000000000000000000000000000000000000000;;	// #include <stdlib.h>
0000000000000000000000000000000000000000;;	//
0000000000000000000000000000000000000000;;	// int
0000000000000000000000000000000000000000;;	// my_strlen(void *f, const char *s)
0000000000000000000000000000000000000000;;	// {
0000000000000000000000000000000000000000;;	//   size_t (*strlen)(const char *);
0000000000000000000000000000000000000000;;	//
0000000000000000000000000000000000000000;;	//   strlen = (size_t (*)(const char *))f;
0000000000000000000000000000000000000000;;	//   return strlen(s);
0000000000000000000000000000000000000000;;	// }
0000000000000000000000000000000000000000;;	import "C"
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	import (
0000000000000000000000000000000000000000;;		"fmt"
0000000000000000000000000000000000000000;;		"unsafe"
0000000000000000000000000000000000000000;;	)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	func strlen(libs []string, s string) (int, error) {
0000000000000000000000000000000000000000;;		h, err := GetHandle(libs)
0000000000000000000000000000000000000000;;		if err != nil {
0000000000000000000000000000000000000000;;			return -1, fmt.Errorf(`couldn't get a handle to the library: %v`, err)
0000000000000000000000000000000000000000;;		}
0000000000000000000000000000000000000000;;		defer h.Close()
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		f := "strlen"
0000000000000000000000000000000000000000;;		cs := C.CString(s)
0000000000000000000000000000000000000000;;		defer C.free(unsafe.Pointer(cs))
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		strlen, err := h.GetSymbolPointer(f)
0000000000000000000000000000000000000000;;		if err != nil {
0000000000000000000000000000000000000000;;			return -1, fmt.Errorf(`couldn't get symbol %q: %v`, f, err)
0000000000000000000000000000000000000000;;		}
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		len := C.my_strlen(strlen, cs)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		return int(len), nil
0000000000000000000000000000000000000000;;	}
