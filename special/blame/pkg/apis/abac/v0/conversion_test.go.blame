0000000000000000000000000000000000000000;;	/*
0000000000000000000000000000000000000000;;	Copyright 2015 The Kubernetes Authors.
6ca75e78d4b5d7d762903a7b5fd5764878b8cae7;;	
0000000000000000000000000000000000000000;;	Licensed under the Apache License, Version 2.0 (the "License");
0000000000000000000000000000000000000000;;	you may not use this file except in compliance with the License.
0000000000000000000000000000000000000000;;	You may obtain a copy of the License at
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	    http://www.apache.org/licenses/LICENSE-2.0
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	Unless required by applicable law or agreed to in writing, software
0000000000000000000000000000000000000000;;	distributed under the License is distributed on an "AS IS" BASIS,
0000000000000000000000000000000000000000;;	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
0000000000000000000000000000000000000000;;	See the License for the specific language governing permissions and
0000000000000000000000000000000000000000;;	limitations under the License.
0000000000000000000000000000000000000000;;	*/
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	package v0_test
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	import (
0000000000000000000000000000000000000000;;		"reflect"
0000000000000000000000000000000000000000;;		"testing"
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;		"k8s.io/apiserver/pkg/authentication/user"
0000000000000000000000000000000000000000;;		api "k8s.io/kubernetes/pkg/apis/abac"
0000000000000000000000000000000000000000;;		"k8s.io/kubernetes/pkg/apis/abac/v0"
0000000000000000000000000000000000000000;;	)
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	func TestV0Conversion(t *testing.T) {
0000000000000000000000000000000000000000;;		testcases := map[string]struct {
0000000000000000000000000000000000000000;;			old      *v0.Policy
0000000000000000000000000000000000000000;;			expected *api.Policy
0000000000000000000000000000000000000000;;		}{
0000000000000000000000000000000000000000;;			// a completely empty policy rule allows everything to all users
0000000000000000000000000000000000000000;;			"empty": {
0000000000000000000000000000000000000000;;				old:      &v0.Policy{},
0000000000000000000000000000000000000000;;				expected: &api.Policy{Spec: api.PolicySpec{Group: user.AllAuthenticated, Readonly: false, NonResourcePath: "*", Namespace: "*", Resource: "*", APIGroup: "*"}},
0000000000000000000000000000000000000000;;			},
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			// specifying a user is preserved
0000000000000000000000000000000000000000;;			"user": {
0000000000000000000000000000000000000000;;				old:      &v0.Policy{User: "bob"},
0000000000000000000000000000000000000000;;				expected: &api.Policy{Spec: api.PolicySpec{User: "bob", Readonly: false, NonResourcePath: "*", Namespace: "*", Resource: "*", APIGroup: "*"}},
0000000000000000000000000000000000000000;;			},
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			// specifying a group is preserved (and no longer matches all users)
0000000000000000000000000000000000000000;;			"group": {
0000000000000000000000000000000000000000;;				old:      &v0.Policy{Group: "mygroup"},
0000000000000000000000000000000000000000;;				expected: &api.Policy{Spec: api.PolicySpec{Group: "mygroup", Readonly: false, NonResourcePath: "*", Namespace: "*", Resource: "*", APIGroup: "*"}},
0000000000000000000000000000000000000000;;			},
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			// specifying * for user or group maps to all authenticated subjects
0000000000000000000000000000000000000000;;			"* user": {
0000000000000000000000000000000000000000;;				old:      &v0.Policy{User: "*"},
0000000000000000000000000000000000000000;;				expected: &api.Policy{Spec: api.PolicySpec{Group: user.AllAuthenticated, Readonly: false, NonResourcePath: "*", Namespace: "*", Resource: "*", APIGroup: "*"}},
0000000000000000000000000000000000000000;;			},
0000000000000000000000000000000000000000;;			"* group": {
0000000000000000000000000000000000000000;;				old:      &v0.Policy{Group: "*"},
0000000000000000000000000000000000000000;;				expected: &api.Policy{Spec: api.PolicySpec{Group: user.AllAuthenticated, Readonly: false, NonResourcePath: "*", Namespace: "*", Resource: "*", APIGroup: "*"}},
0000000000000000000000000000000000000000;;			},
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			// specifying a namespace removes the * match on non-resource path
0000000000000000000000000000000000000000;;			"namespace": {
0000000000000000000000000000000000000000;;				old:      &v0.Policy{Namespace: "myns"},
0000000000000000000000000000000000000000;;				expected: &api.Policy{Spec: api.PolicySpec{Group: user.AllAuthenticated, Readonly: false, NonResourcePath: "", Namespace: "myns", Resource: "*", APIGroup: "*"}},
0000000000000000000000000000000000000000;;			},
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			// specifying a resource removes the * match on non-resource path
0000000000000000000000000000000000000000;;			"resource": {
0000000000000000000000000000000000000000;;				old:      &v0.Policy{Resource: "myresource"},
0000000000000000000000000000000000000000;;				expected: &api.Policy{Spec: api.PolicySpec{Group: user.AllAuthenticated, Readonly: false, NonResourcePath: "", Namespace: "*", Resource: "myresource", APIGroup: "*"}},
0000000000000000000000000000000000000000;;			},
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;			// specifying a namespace+resource removes the * match on non-resource path
0000000000000000000000000000000000000000;;			"namespace+resource": {
0000000000000000000000000000000000000000;;				old:      &v0.Policy{Namespace: "myns", Resource: "myresource"},
0000000000000000000000000000000000000000;;				expected: &api.Policy{Spec: api.PolicySpec{Group: user.AllAuthenticated, Readonly: false, NonResourcePath: "", Namespace: "myns", Resource: "myresource", APIGroup: "*"}},
0000000000000000000000000000000000000000;;			},
0000000000000000000000000000000000000000;;		}
0000000000000000000000000000000000000000;;		for k, tc := range testcases {
0000000000000000000000000000000000000000;;			internal := &api.Policy{}
0000000000000000000000000000000000000000;;			if err := api.Scheme.Convert(tc.old, internal, nil); err != nil {
0000000000000000000000000000000000000000;;				t.Errorf("%s: unexpected error: %v", k, err)
0000000000000000000000000000000000000000;;			}
0000000000000000000000000000000000000000;;			if !reflect.DeepEqual(internal, tc.expected) {
0000000000000000000000000000000000000000;;				t.Errorf("%s: expected\n\t%#v, got \n\t%#v", k, tc.expected, internal)
0000000000000000000000000000000000000000;;			}
0000000000000000000000000000000000000000;;		}
0000000000000000000000000000000000000000;;	}
