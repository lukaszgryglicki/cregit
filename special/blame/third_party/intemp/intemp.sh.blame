0000000000000000000000000000000000000000;;	#!/usr/bin/env bash
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	# Runs the supplied bash command string in a temporary workspace directory.
0000000000000000000000000000000000000000;;	# Usage: intemp.sh [-t prefix] <command>
0000000000000000000000000000000000000000;;	# Requires: mktemp
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	set -o errexit
0000000000000000000000000000000000000000;;	set -o nounset
0000000000000000000000000000000000000000;;	set -o pipefail
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	opt_flag=${1:-}
0000000000000000000000000000000000000000;;	[ -z "${opt_flag}" ] && echo "No command supplied" >&2 && exit 1
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	if [ "${opt_flag}" == "-t" ]; then
0000000000000000000000000000000000000000;;	  shift
0000000000000000000000000000000000000000;;	  prefix=${1:-}
0000000000000000000000000000000000000000;;	  [ -z "${prefix}" ] && echo "No prefix supplied" >&2 && exit 1
0000000000000000000000000000000000000000;;	  shift
0000000000000000000000000000000000000000;;	else
0000000000000000000000000000000000000000;;	  prefix='temp'
0000000000000000000000000000000000000000;;	fi
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	cmd="$1"
0000000000000000000000000000000000000000;;	[ -z "${cmd}" ] && echo "No command supplied" >&2 && exit 1
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	workspace=$(mktemp -d "${TMPDIR:-/tmp}/${prefix}.XXXXXX")
0000000000000000000000000000000000000000;;	echo "Workspace created: ${workspace}" 1>&2
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	cleanup() {
0000000000000000000000000000000000000000;;	  local -r workspace="$1"
0000000000000000000000000000000000000000;;	  rm -rf "${workspace}"
0000000000000000000000000000000000000000;;	  echo "Workspace deleted: ${workspace}" 1>&2
0000000000000000000000000000000000000000;;	}
0000000000000000000000000000000000000000;;	trap "cleanup '${workspace}'" EXIT
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	pushd "${workspace}" > /dev/null
0000000000000000000000000000000000000000;;	bash -ceu "${cmd}"
0000000000000000000000000000000000000000;;	popd > /dev/null
0000000000000000000000000000000000000000;;	
0000000000000000000000000000000000000000;;	trap - EXIT
0000000000000000000000000000000000000000;;	cleanup "${workspace}"
